<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpatialAnno for MOB • SpatialAnno</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SpatialAnno for MOB">
<meta property="og:description" content="SpatialAnno">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpatialAnno</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SpatialAnno.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MOB.html">SpatialAnno for MOB</a>
    </li>
    <li>
      <a href="../articles/brain.html">SpatialAnno for Human_Brain</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MOB_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SpatialAnno for MOB</h1>
            
      
      
      <div class="hidden name"><code>MOB.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="mouse-olfactory-bulb-mob">mouse olfactory bulb (MOB)<a class="anchor" aria-label="anchor" href="#mouse-olfactory-bulb-mob"></a>
</h2>
<p>We obtained the mouse olfactory bulb ST data from the spatial transcriptomics research website (<a href="https://www.spatialresearch.org/" class="external-link uri">https://www.spatialresearch.org/</a>). This data consists of gene expression levels in form of read counts which are collected for a number of spatial locations. We followed to focus on the mouse OB section 12, which contains 16,034 genes and 282 spatial locations. The gene expression of mouse OB section 12 and ground truth are both stored in the R package <code>SpatialAnno</code>.</p>
<div class="section level3">
<h3 id="load-the-mob-dataset">load the MOB dataset<a class="anchor" aria-label="anchor" href="#load-the-mob-dataset"></a>
</h3>
<p>First, we load the MOB dataset and extract the position of each spot from spot name. The four anatomic layers manually annotated based on H&amp;E staining was taken as ground truth.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SpatialAnno</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"SpatialAnno"</span><span class="op">)</span>, <span class="st">"/extdata/Rep12_MOB_count_matrix-1.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">MOB_raw</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 6 x 6 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">##         16.918x16.996 18.017x17.034 20.075x17.059 18.979x17.065 21.937x16.967</span></span>
<span><span class="co">## Plekha1             5             1             .             .             1</span></span>
<span><span class="co">## Cnih3               1             1             1             .             .</span></span>
<span><span class="co">## Gpc5                1             .             .             .             .</span></span>
<span><span class="co">## Sirt3               2             1             .             .             .</span></span>
<span><span class="co">## Rab8a               5             1             .             .             1</span></span>
<span><span class="co">## Nadk                1             1             .             1             1</span></span>
<span><span class="co">##         20.899x17.015</span></span>
<span><span class="co">## Plekha1             .</span></span>
<span><span class="co">## Cnih3               1</span></span>
<span><span class="co">## Gpc5                1</span></span>
<span><span class="co">## Sirt3               .</span></span>
<span><span class="co">## Rab8a               .</span></span>
<span><span class="co">## Nadk                .</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MOB_raw</span><span class="op">)</span>,split<span class="op">=</span><span class="st">"x"</span><span class="op">)</span>,<span class="st">"["</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MOB_raw</span><span class="op">)</span>,split<span class="op">=</span><span class="st">"x"</span><span class="op">)</span>,<span class="st">"["</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        x      y</span></span>
<span><span class="co">## 1 16.918 16.996</span></span>
<span><span class="co">## 2 18.017 17.034</span></span>
<span><span class="co">## 3 20.075 17.059</span></span>
<span><span class="co">## 4 18.979 17.065</span></span>
<span><span class="co">## 5 21.937 16.967</span></span>
<span><span class="co">## 6 20.899 17.015</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"SpatialAnno"</span><span class="op">)</span>, <span class="st">"/extdata/Rep12_MOB_manual_annotation.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y2</span> <span class="op">=</span> <span class="va">Rep12_MOB_manual_annotation</span></span>
<span><span class="va">y2</span><span class="op">[</span><span class="va">y2</span><span class="op">==</span><span class="st">"GCL"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"GC"</span></span>
<span><span class="va">y2</span><span class="op">[</span><span class="va">y2</span><span class="op">==</span><span class="st">"MCL"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"M/TC"</span></span>
<span><span class="va">y2</span><span class="op">[</span><span class="va">y2</span><span class="op">==</span><span class="st">"ONL"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"OSNs"</span></span>
<span><span class="va">y2</span><span class="op">[</span><span class="va">y2</span><span class="op">==</span><span class="st">"GL"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"PGC"</span></span></code></pre></div>
<p>Then we construct the Seurat object with the raw count of MOB.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MOB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">MOB_raw</span>, project <span class="op">=</span> <span class="st">"MOB"</span><span class="op">)</span></span></code></pre></div>
<p>Then we perform the normalization using function <code>SCTransform</code> implemented in R package <code>Seurat</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MOB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/SCTransform.html" class="external-link">SCTransform</a></span><span class="op">(</span><span class="va">MOB</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">MOB</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">SCT</span><span class="op">@</span><span class="va">scale.data</span><span class="op">)</span></span></code></pre></div>
<p>Then we read the cell-type-specific marker information and construct a cell type marker matrix. Top four DEGs of the scRNA-seq data from Gene Expression Omnibus (GEO;accession number GSE121891) are selected as markers based on log-fold change.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">marker</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GC"</span>, <span class="st">"PGC"</span>, <span class="st">"M/TC"</span>, <span class="st">"OSNs"</span>, <span class="st">"EPL-IN"</span><span class="op">)</span></span>
<span><span class="va">marker</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gria2"</span>, <span class="st">"Meis2"</span>, <span class="st">"Prkca"</span>, <span class="st">"Penk"</span><span class="op">)</span></span>
<span><span class="va">marker</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nppa"</span>, <span class="st">"Nrsn1"</span>, <span class="st">"Nxph1"</span>, <span class="st">"Th"</span><span class="op">)</span></span>
<span><span class="va">marker</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cdhr1"</span>, <span class="st">"Slc17a7"</span>, <span class="st">"Olfm1"</span>, <span class="st">"Reln"</span><span class="op">)</span></span>
<span><span class="va">marker</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gng13"</span>, <span class="st">"S100a5"</span>, <span class="st">"Omp"</span>, <span class="st">"Fam213b"</span><span class="op">)</span></span>
<span><span class="va">marker</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kit"</span>, <span class="st">"Thy1"</span>,  <span class="st">"Dner"</span>, <span class="st">"Spock2"</span><span class="op">)</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marker_list_to_mat.html">marker_list_to_mat</a></span><span class="op">(</span><span class="va">marker</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">marker</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $GC</span></span>
<span><span class="co">## [1] "Gria2" "Meis2" "Prkca" "Penk" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $PGC</span></span>
<span><span class="co">## [1] "Nppa"  "Nrsn1" "Nxph1" "Th"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`M/TC`</span></span>
<span><span class="co">## [1] "Cdhr1"   "Slc17a7" "Olfm1"   "Reln"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $OSNs</span></span>
<span><span class="co">## [1] "Gng13"   "S100a5"  "Omp"     "Fam213b"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`EPL-IN`</span></span>
<span><span class="co">## [1] "Kit"    "Thy1"   "Dner"   "Spock2"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-spatialanno-on-dataset-mob">Run SpatialAnno on dataset MOB<a class="anchor" aria-label="anchor" href="#run-spatialanno-on-dataset-mob"></a>
</h3>
<p>Then we find the neighborhoods using the function <code>getneighborhhod_fast</code> implemented in our package <code>SpatialAnno</code>, with specifying the cutoff as 1.2 to ensure that the median number of neighboorhoods is about 4, as MOB was sequenced on the platform ST. After obtaining the sparse neighborhoods matrix <code>Adj_sp</code>, we can run SpatialAnno with normalized gene expression matrix <code>X</code>, sparse neighborhoods matrix <code>Adj_sp</code>, and a list of markers <code>marker</code>. Note that we choose the initial value from annotation methods <code>SCINA</code> due to the large number of non-markers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Adj_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getneighborhood_fast.html">getneighborhood_fast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialAnno.html">SpatialAnno</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Adj_sp <span class="op">=</span> <span class="va">Adj_sp</span>, marker <span class="op">=</span> <span class="va">marker</span>, initial <span class="op">=</span> <span class="st">"SCINA"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Gria2" "Meis2" "Penk"  "Prkca"</span></span>
<span><span class="co">## [1] "Nppa"  "Nrsn1" "Nxph1" "Th"   </span></span>
<span><span class="co">## [1] "Cdhr1"   "Olfm1"   "Reln"    "Slc17a7"</span></span>
<span><span class="co">## [1] "Fam213b" "Gng13"   "Omp"     "S100a5" </span></span>
<span><span class="co">## [1] "Dner"   "Kit"    "Spock2" "Thy1"  </span></span>
<span><span class="co">## iter = 2, loglik= -1022883.466774, dloglik=0.999524 </span></span>
<span><span class="co">## iter = 3, loglik= -1022389.735795, dloglik=0.000483 </span></span>
<span><span class="co">## iter = 4, loglik= -1022343.565449, dloglik=0.000045 </span></span>
<span><span class="co">## iter = 5, loglik= -1022330.201749, dloglik=0.000013 </span></span>
<span><span class="co">## iter = 6, loglik= -1022317.792909, dloglik=0.000012 </span></span>
<span><span class="co">## iter = 7, loglik= -1022308.740946, dloglik=0.000009 </span></span>
<span><span class="co">## iter = 8, loglik= -1022297.279651, dloglik=0.000011 </span></span>
<span><span class="co">## iter = 9, loglik= -1022291.161422, dloglik=0.000006 </span></span>
<span><span class="co">## iter = 10, loglik= -1022287.419029, dloglik=0.000004 </span></span>
<span><span class="co">## iter = 11, loglik= -1022280.593982, dloglik=0.000007 </span></span>
<span><span class="co">## iter = 12, loglik= -1022277.870902, dloglik=0.000003 </span></span>
<span><span class="co">## iter = 13, loglik= -1022274.239868, dloglik=0.000004 </span></span>
<span><span class="co">## iter = 14, loglik= -1022271.060462, dloglik=0.000003 </span></span>
<span><span class="co">## iter = 15, loglik= -1022269.511761, dloglik=0.000002 </span></span>
<span><span class="co">## iter = 16, loglik= -1022268.370673, dloglik=0.000001 </span></span>
<span><span class="co">## iter = 17, loglik= -1022267.370783, dloglik=0.000001</span></span></code></pre>
<p>We demonstrate the output of SpatialAnno, which is a list contains many items. We will briefly explain them one by one in the following part.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 13</span></span>
<span><span class="co">##  $ R      : num [1:282, 1:6] 1.00 2.41e-22 1.80e-40 8.22e-39 6.75e-25 ...</span></span>
<span><span class="co">##  $ xi     : num 2.3</span></span>
<span><span class="co">##  $ type   : int [1:282, 1] 1 2 4 4 3 2 3 1 3 4 ...</span></span>
<span><span class="co">##  $ alpha_m: num [1:20, 1] -0.252 -0.453 -0.594 -0.434 -0.129 ...</span></span>
<span><span class="co">##  $ bet_m  : num [1:20, 1:6] 0.935 1.681 2.205 1.61 0 ...</span></span>
<span><span class="co">##  $ mu_m   : num [1:20, 1:6] 0.683 1.228 1.611 1.176 -0.129 ...</span></span>
<span><span class="co">##  $ sigma_m: num [1:20, 1] 1.044 0.888 0.837 0.87 0.82 ...</span></span>
<span><span class="co">##  $ Ez_u   : num [1:282, 1:15] -18.23 8.72 2 1.82 13.02 ...</span></span>
<span><span class="co">##  $ Mu_u   : num [1:6, 1:15] -14.93 6.49 10.53 1.11 1.21 ...</span></span>
<span><span class="co">##  $ Sgm_u  : num [1:15, 1:15] 10.37 -4.65 2.53 -2.71 1.55 ...</span></span>
<span><span class="co">##  $ W_u    : num [1:2980, 1:15] -0.01471 -0.01073 0.00933 -0.03249 -0.02646 ...</span></span>
<span><span class="co">##  $ Lam_u  : num [1:2980, 1] 0.938 0.961 0.814 0.634 0.962 ...</span></span>
<span><span class="co">##  $ loglik : num [1:16] -2.15e+09 -1.02e+06 -1.02e+06 -1.02e+06 -1.02e+06 ...</span></span></code></pre>
<ul>
<li>‘R’ the estimator of probability that each spot was assigned to these five cell types or “Unknown”. The order of the cell types is the same as that of cell types in gene marker matrix.</li>
<li>‘xi’ the estimator of smooth parameter.</li>
<li>‘type’ the predicated cell types for each spot.</li>
<li>‘alpha_m’ the estimator of base expression level.</li>
<li>‘bet_m’ the estimator of extra expression level.</li>
<li>‘mu_m’ the mean of cell types in marker group.</li>
<li>‘sigma_m’ the covariance matrix of cell types in marker group.</li>
<li>‘Ez_u’ the low-dimensional embedding.</li>
<li>‘Mu_u’ the mean of cell types in non-marker group.</li>
<li>‘Sgm_u’ the covariance matrix of cell types in non-marker group.</li>
<li>‘W_u’ the estimator of factor loading matrix.</li>
<li>‘Lam_u’ the variance of error in non-marker group.</li>
<li>‘loglik’ the vector of log-likelihood of <code>SpatialAnno</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="plot-the-annotation-results">plot the annotation results<a class="anchor" aria-label="anchor" href="#plot-the-annotation-results"></a>
</h3>
<p>The predictions can be obtained in the following way. Then we can plot the annotation results of SpatialAnno on the spatial positions using R package <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prediction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span><span class="op">[</span><span class="va">fit</span><span class="op">$</span><span class="va">type</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "GC"      "PGC"     "OSNs"    "OSNs"    "M/TC"    "PGC"     "M/TC"   </span></span>
<span><span class="co">##  [8] "GC"      "M/TC"    "OSNs"    "OSNs"    "OSNs"    "OSNs"    "OSNs"   </span></span>
<span><span class="co">## [15] "OSNs"    "Unknown" "PGC"     "Unknown" "GC"      "GC"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="va">colfunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"white"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit_type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span><span class="op">[</span><span class="va">fit</span><span class="op">$</span><span class="va">type</span><span class="op">]</span></span>
<span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pos</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">pos</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fit_type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"imagerow"</span>, <span class="st">"imagecol"</span>, <span class="st">"Cell type"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">imagerow</span>, y<span class="op">=</span><span class="va">imagecol</span>, color<span class="op">=</span><span class="va">`Cell type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FFD700"</span>, <span class="fu">colfunc</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Greens"</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/pkg/scales/man/hue_pal.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Blues"</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>, <span class="st">"#808080"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="MOB_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="calculate-kappa-mf1-and-acc">calculate Kappa, mF1, and acc<a class="anchor" aria-label="anchor" href="#calculate-kappa-mf1-and-acc"></a>
</h3>
<p>After obtaining the predictions, we can calculate Kappa, mF1 (mean F1), and acc to evalute the performance of annotation results by <code>SpatialAnno</code>. The function <code>cohen.kappa</code> to calculate Kappa is implemented in the package psych. The function <code>evaluate</code> to calculate mF1 is implemented in our package <code>SpatialAnno</code>. The Kappa is</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://personality-project.org/r/psych/" class="external-link">psych</a></span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y2</span><span class="op">!=</span><span class="st">"Unknown"</span> <span class="op">&amp;</span> <span class="va">prediction</span><span class="op">!=</span><span class="st">"Unknown"</span><span class="op">)</span></span>
<span><span class="va">Kappa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/psych/man/kappa.html" class="external-link">cohen.kappa</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y2</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>, <span class="va">prediction</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">kappa</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Kappa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.7391692</span></span></code></pre>
<p>The mF1 is</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mF1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">y2</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>, <span class="va">prediction</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">F1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mF1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.8138647</span></span></code></pre>
<p>The acc is</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y2</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">==</span> <span class="va">prediction</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">acc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.8</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="extract-the-embeddings">extract the embeddings<a class="anchor" aria-label="anchor" href="#extract-the-embeddings"></a>
</h3>
<p>Then we extract the embeddings from the output of <code>SpatialAnno</code>, and plot the tSNE and calculate ARI with the function <code>adjustedRandIndex</code> implemented in the R package <code>mclust</code></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span></span>
<span><span class="va">embedding</span> <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">Ez_u</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            [,1]      [,2]       [,3]      [,4]       [,5]        [,6]      [,7]</span></span>
<span><span class="co">## [1,] -18.228770 15.640597 -8.5896255  4.426338  1.0558159   7.3838150 -5.827854</span></span>
<span><span class="co">## [2,]   8.717592 -7.960629 -5.5023852  1.197099  3.7835684  -0.8201792 -2.920445</span></span>
<span><span class="co">## [3,]   2.001903 -3.850211  1.2476928 -1.565176 -0.4773491 -18.8862657 21.000166</span></span>
<span><span class="co">## [4,]   1.823851 -3.460382  5.1927435 -1.211686  2.2126560 -13.5406390 11.973193</span></span>
<span><span class="co">## [5,]  13.017165  7.302807 -0.3653341 -1.301280 -2.0256613   4.9303242 -2.443902</span></span>
<span><span class="co">## [6,]   4.938710 -2.023808 -1.9841202  3.138582  1.5821686   2.0986954 -1.698943</span></span>
<span><span class="co">##           [,8]        [,9]      [,10]       [,11]      [,12]       [,13]</span></span>
<span><span class="co">## [1,]  2.264353 -3.69928581  1.0718249 -1.45476754 -1.0693397  0.04821921</span></span>
<span><span class="co">## [2,]  5.343680 -2.33882184  0.5669334 -3.82606817  0.7485158  1.19534126</span></span>
<span><span class="co">## [3,]  4.764045 -5.68965761 -5.8818437  0.84893472  3.1287520  1.31251372</span></span>
<span><span class="co">## [4,]  5.097046  0.08194153 -5.1038824 -0.30378157 12.5101063 -8.82683819</span></span>
<span><span class="co">## [5,] -3.284255 -2.01694464  0.6703394 -0.04856227 -1.1720375 -0.62960772</span></span>
<span><span class="co">## [6,]  3.484273 -0.97269636 -0.8826282  3.87656553 -0.2722532  0.31662710</span></span>
<span><span class="co">##         [,14]        [,15]</span></span>
<span><span class="co">## [1,] 1.189905  2.935940083</span></span>
<span><span class="co">## [2,] 2.670998 -2.053067683</span></span>
<span><span class="co">## [3,] 3.041590 -5.033696367</span></span>
<span><span class="co">## [4,] 7.921903 -5.806457120</span></span>
<span><span class="co">## [5,] 3.238418  0.008782105</span></span>
<span><span class="co">## [6,] 3.724550  1.675002258</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsne</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runTSNE.html" class="external-link">calculateTSNE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The tSNE plot is</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">tsne</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">cluster</span> <span class="op">=</span> <span class="va">prediction</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span>, color<span class="op">=</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_Publication.html">theme_Publication</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FFD700"</span>, <span class="fu">colfunc</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Greens"</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/pkg/scales/man/hue_pal.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Blues"</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>, <span class="st">"#808080"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="MOB_files/figure-html/unnamed-chunk-12-1.png" width="384"></p>
<p>Then we perform the clustering analysis with GMM (other clustering methods are also can be used) on embeddings and calculate ARI. The ARI is</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">=</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/Mclust.html" class="external-link">Mclust</a></span><span class="op">(</span><span class="va">embedding</span>, G <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ARI</span> <span class="op">=</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/adjustedRandIndex.html" class="external-link">adjustedRandIndex</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">classification</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ARI</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.4637656</span></span></code></pre>
<p>We can also plot RGB plot with the function <code>plot_RGB</code> implemented in <code>PRECAST</code>. The RGB plot is demonstrated as follows</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/PRECAST" class="external-link">PRECAST</a></span><span class="op">)</span></span>
<span><span class="va">tsne3dim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runTSNE.html" class="external-link">calculateTSNE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span>, ncomponents <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">pList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PRECAST/man/plot_RGB.html" class="external-link">plot_RGB</a></span><span class="op">(</span><span class="va">pos</span>, <span class="va">tsne3dim</span>, pointsize <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pList</span></span></code></pre></div>
<p><img src="MOB_files/figure-html/unnamed-chunk-14-1.png" width="288"></p>
</div>
<div class="section level3">
<h3 id="gene-expression-plot-of-markers">gene expression plot of markers<a class="anchor" aria-label="anchor" href="#gene-expression-plot-of-markers"></a>
</h3>
<p>We can also plot the expression levels of corresponding cell type-specific marker genes.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kit"</span>, <span class="st">"Penk"</span>,<span class="st">"Cdhr1"</span>, <span class="st">"S100a5"</span>, <span class="st">"Th"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">genes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pos</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">pos</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">X</span><span class="op">[</span>,<span class="va">idx</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"imagerow"</span>, <span class="st">"imagecol"</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span>    <span class="va">dat</span><span class="op">$</span><span class="va">gene</span> <span class="op">=</span> <span class="va">genes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">genes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dat2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pos</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">pos</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">X</span><span class="op">[</span>,<span class="va">idx</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">)</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"imagerow"</span>, <span class="st">"imagecol"</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span>    <span class="va">dat2</span><span class="op">$</span><span class="va">gene</span> <span class="op">=</span> <span class="va">genes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">dat2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#0571B0"</span>,  <span class="st">"#CA0020"</span><span class="op">)</span></span>
<span><span class="va">quant</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="va">med</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">MOB</span><span class="op">[[</span><span class="st">"SCT"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">scale.data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kit"</span>, <span class="st">"Penk"</span>,<span class="st">"Cdhr1"</span>, <span class="st">"S100a5"</span>, <span class="st">"Th"</span><span class="op">)</span>,<span class="op">]</span>, <span class="fl">1</span>, <span class="va">quantile</span>, <span class="va">quant</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">gene</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">gene</span>, levels <span class="op">=</span> <span class="va">genes</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">marker</span> <span class="op">=</span> <span class="st">"marker"</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">imagerow</span>, y<span class="op">=</span><span class="va">imagecol</span>, color<span class="op">=</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">marker</span><span class="op">~</span><span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_gradient.html" class="external-link">scale_colour_gradient2</a></span><span class="op">(</span></span>
<span>    low <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    mid <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    high <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_Publication.html">theme_Publication</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="MOB_files/figure-html/unnamed-chunk-15-1.png" width="1920"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yi Yang, Xingjie Shi.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
